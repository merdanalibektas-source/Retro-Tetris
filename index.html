<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Retro Tetris">
    <title>Retro Tetris - iOS</title>
    <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }

        body {
            background: #000;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            position: fixed;
            width: 100%;
        }

        .game-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 10px;
        }

        .title {
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 0 10px #00ff00;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-board {
            width: 200px;
            height: 400px;
            border: 2px solid #00ff00;
            background: rgba(0, 0, 0, 0.8);
            position: relative;
            display: grid;
            grid-template-columns: repeat(10, 1fr);
            grid-template-rows: repeat(20, 1fr);
            gap: 1px;
            margin-bottom: 20px;
        }

        .cell {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.2);
            transition: all 0.2s;
        }

        .cell.filled {
            background: #00ff00;
            box-shadow: 0 0 5px #00ff00;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 200px;
            margin-bottom: 20px;
        }

        .control-btn {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            color: #00ff00;
            padding: 15px 10px;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            touch-action: manipulation;
            user-select: none;
            border-radius: 5px;
        }

        .control-btn:active {
            background: rgba(0, 255, 0, 0.4);
            transform: scale(0.95);
        }

        .drop-btn {
            grid-column: span 3;
            font-size: 16px;
            padding: 20px;
        }

        .info {
            display: flex;
            justify-content: space-between;
            width: 200px;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .install-prompt {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(0, 255, 0, 0.9);
            color: #000;
            padding: 10px;
            text-align: center;
            font-size: 12px;
            z-index: 1000;
        }

        .install-btn {
            background: #000;
            color: #00ff00;
            border: 1px solid #000;
            padding: 5px 10px;
            margin-left: 10px;
            border-radius: 3px;
        }

        @media (max-width: 480px) {
            .game-board {
                width: 180px;
                height: 360px;
            }
            .controls {
                width: 180px;
            }
            .info {
                width: 180px;
            }
        }

        /* iOS Safari specific */
        @supports (-webkit-touch-callout: none) {
            body {
                -webkit-overflow-scrolling: touch;
            }
        }
    </style>
</head>
<body>
    <div class="install-prompt" id="installPrompt" style="display: none;">
        üì± Ana ekrana ekleyerek uygulama gibi kullanƒ±n!
        <button class="install-btn" onclick="showInstallInstructions()">Nasƒ±l?</button>
        <button class="install-btn" onclick="hideInstallPrompt()">√ó</button>
    </div>

    <div class="game-container">
        <div class="title">üéÆ RETRO TETRIS</div>
        
        <div class="info">
            <span>Skor: <span id="score">0</span></span>
            <span>Seviye: <span id="level">1</span></span>
            <span>Satƒ±r: <span id="lines">0</span></span>
        </div>

        <div class="game-board" id="gameBoard"></div>

        <div class="controls">
            <button class="control-btn" id="leftBtn">‚óÄ</button>
            <button class="control-btn" id="rotateBtn">‚Üª</button>
            <button class="control-btn" id="rightBtn">‚ñ∂</button>
            <button class="control-btn drop-btn" id="dropBtn">‚¨á D√ú≈û√úR</button>
        </div>

        <div style="font-size: 10px; text-align: center; opacity: 0.7;">
            Dokunmatik: Kaydƒ±r (hareket) ‚Ä¢ Dokun (d√∂nd√ºr)
        </div>
    </div>

    <script>
        class RetroTetris {
            constructor() {
                this.board = Array(20).fill().map(() => Array(10).fill(0));
                this.score = 0;
                this.level = 1;
                this.lines = 0;
                this.gameRunning = false;
                this.currentPiece = null;
                
                this.init();
                this.setupControls();
                this.setupTouchControls();
                this.start();
            }

            init() {
                const gameBoard = document.getElementById('gameBoard');
                gameBoard.innerHTML = '';
                
                for (let row = 0; row < 20; row++) {
                    for (let col = 0; col < 10; col++) {
                        const cell = document.createElement('div');
                        cell.className = 'cell';
                        cell.dataset.row = row;
                        cell.dataset.col = col;
                        gameBoard.appendChild(cell);
                    }
                }
            }

            setupControls() {
                document.getElementById('leftBtn').addEventListener('click', () => this.moveLeft());
                document.getElementById('rightBtn').addEventListener('click', () => this.moveRight());
                document.getElementById('rotateBtn').addEventListener('click', () => this.rotate());
                document.getElementById('dropBtn').addEventListener('click', () => this.drop());
            }

            setupTouchControls() {
                let startX, startY;
                
                document.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                }, { passive: false });

                document.addEventListener('touchmove', (e) => {
                    e.preventDefault();
                }, { passive: false });

                document.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    if (!startX || !startY) return;
                    
                    const endX = e.changedTouches[0].clientX;
                    const endY = e.changedTouches[0].clientY;
                    
                    const diffX = startX - endX;
                    const diffY = startY - endY;
                    
                    if (Math.abs(diffX) > Math.abs(diffY)) {
                        if (Math.abs(diffX) > 30) {
                            if (diffX > 0) this.moveLeft();
                            else this.moveRight();
                        }
                    } else {
                        if (Math.abs(diffY) > 30) {
                            if (diffY < 0) this.drop();
                        } else {
                            this.rotate();
                        }
                    }
                    
                    startX = startY = null;
                }, { passive: false });
            }

            start() {
                this.gameRunning = true;
                this.spawnPiece();
                this.gameLoop();
            }

            spawnPiece() {
                // Rastgele tetromino sim√ºlasyonu
                const shapes = [
                    [[1,1,1,1]], // I
                    [[1,1],[1,1]], // O
                    [[0,1,0],[1,1,1]], // T
                    [[0,1,1],[1,1,0]], // S
                    [[1,1,0],[0,1,1]], // Z
                ];
                
                const shape = shapes[Math.floor(Math.random() * shapes.length)];
                const startCol = Math.floor(Math.random() * (10 - shape[0].length));
                
                // ≈ûekli tahtaya yerle≈ütir
                for (let row = 0; row < shape.length; row++) {
                    for (let col = 0; col < shape[row].length; col++) {
                        if (shape[row][col] && row < 20 && startCol + col < 10) {
                            this.board[row][startCol + col] = 1;
                            this.updateCell(row, startCol + col, true);
                        }
                    }
                }
            }

            moveLeft() {
                this.addScore(1);
                this.animateMove();
                // Haptic feedback
                if (navigator.vibrate) navigator.vibrate(10);
            }

            moveRight() {
                this.addScore(1);
                this.animateMove();
                if (navigator.vibrate) navigator.vibrate(10);
            }

            rotate() {
                this.addScore(2);
                this.animateRotate();
                if (navigator.vibrate) navigator.vibrate(20);
            }

            drop() {
                this.addScore(10);
                this.clearLine();
                if (navigator.vibrate) navigator.vibrate(50);
            }

            animateMove() {
                const cells = document.querySelectorAll('.cell.filled');
                if (cells.length > 0) {
                    const cell = cells[Math.floor(Math.random() * cells.length)];
                    cell.style.transform = 'scale(1.2)';
                    setTimeout(() => {
                        cell.style.transform = 'scale(1)';
                    }, 100);
                }
            }

            animateRotate() {
                const cells = document.querySelectorAll('.cell.filled');
                cells.forEach(cell => {
                    cell.style.transform = 'rotate(90deg)';
                    setTimeout(() => {
                        cell.style.transform = 'rotate(0deg)';
                    }, 200);
                });
            }

            clearLine() {
                // Rastgele satƒ±r temizle
                const row = Math.floor(Math.random() * 20);
                let cleared = false;
                
                for (let col = 0; col < 10; col++) {
                    const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                    if (cell && cell.classList.contains('filled')) {
                        cell.style.background = '#ff0080';
                        setTimeout(() => {
                            cell.classList.remove('filled');
                            cell.style.background = 'rgba(0, 255, 0, 0.1)';
                        }, 300);
                        cleared = true;
                    }
                }
                
                if (cleared) {
                    this.lines++;
                    this.addScore(100);
                }
                
                // Yeni par√ßa spawn et
                setTimeout(() => this.spawnPiece(), 500);
            }

            addScore(points) {
                this.score += points;
                if (this.score > this.level * 500) {
                    this.level++;
                }
                this.updateDisplay();
            }

            updateCell(row, col, filled) {
                const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
                if (cell) {
                    if (filled) {
                        cell.classList.add('filled');
                    } else {
                        cell.classList.remove('filled');
                    }
                }
            }

            updateDisplay() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('level').textContent = this.level;
                document.getElementById('lines').textContent = this.lines;
            }

            gameLoop() {
                if (!this.gameRunning) return;
                
                // Otomatik par√ßa spawn
                if (Math.random() < 0.02) {
                    this.spawnPiece();
                }
                
                setTimeout(() => this.gameLoop(), 1000 - (this.level * 50));
            }
        }

        // Oyunu ba≈ülat
        let game;
        
        document.addEventListener('DOMContentLoaded', function() {
            // iOS optimizasyonlarƒ±
            document.addEventListener('touchstart', function() {}, { passive: true });
            
            // Oyunu ba≈ülat
            game = new RetroTetris();
            
            // Install prompt g√∂ster
            setTimeout(() => {
                if (!window.navigator.standalone) {
                    document.getElementById('installPrompt').style.display = 'block';
                }
            }, 3000);
        });

        function showInstallInstructions() {
            alert('üì± Ana Ekrana Ekleme:\n\n1. Safari\'de Payla≈ü butonuna (‚¨ÜÔ∏è) tƒ±klayƒ±n\n2. "Ana Ekrana Ekle" se√ßin\n3. "Ekle" butonuna tƒ±klayƒ±n\n\nArtƒ±k ana ekrandan uygulama gibi a√ßabilirsiniz!');
        }

        function hideInstallPrompt() {
            document.getElementById('installPrompt').style.display = 'none';
        }

        // Prevent zoom
        document.addEventListener('gesturestart', function (e) {
            e.preventDefault();
        });

        document.addEventListener('gesturechange', function (e) {
            e.preventDefault();
        });

        document.addEventListener('gestureend', function (e) {
            e.preventDefault();
        });
    </script>
</body>
</html>